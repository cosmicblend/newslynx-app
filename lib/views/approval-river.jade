extends layout

//- block css
//- 	link(rel='stylesheet', href='/stylesheets/fancybox/jquery.fancybox.css')

block drawer
	ul.division-switcher
		li(data-mode="my-recipes") My recipes
		li(data-mode="create-new") + Create
	.drawer-container.mode-content(data-mode="my-recipes")
		if (accountRecipes.length != 0)
			.drawer-pointer Show me...
			.drawer-list-item
				.view-all.drawer-list-outer
					.inputs-container
						input(type="radio")
					.drawer-list-inner
						.title Pending items for all recipes
			.drawer-pointer Or, pending items for just...
			ul#recipes.drawer-list-item-ul
		else
			.drawer-pointer 
				p You don't have any recipes yet!
				p Click the <span>Create</span> button above to start. Or, if you've just made some. refresh the page.
	.drawer-container.mode-content(data-mode="create-new")
		.drawer-pointer  Add any one of these receipes with the form on the right.
		ul#recipe-creators

block content
	#river-items-container(data-mode="my-recipes").mode-content


//- This template has to be rendered partially in standard html because jade
//- In all its glory
//- Will not render underscore variables inside of attributes such as `.master-switch(data-enabled="<%= enabled %>")`
block templates
	script(type="text/jst")#recipe-templ
		.drawer-list-outer.modal-parent
			.inputs-container
				input(type="radio")
			.drawer-list-inner
				.count <%= pending %> pending
				.title <%= name %>
				.description Query: `<%= displaySearchParams(source, settings) %>`
				.toolbar
					.btn.settings-switch
						span.octicon.octicon-gear
						span.text  Edit
					|<span class="service-icon" data-service="<%= serviceFromSource(source) %>"><span class="service-method-label"><%= methodFromSource(source) %></span></span>
					|<div class="btn enable-switch" data-enabled="<%= enabled %>"><%= formatEnabled(enabled) %></div>
			.modal-outer
				.modal-overlay
				.modal-inner
					.title Recipe settings
					form
						<%= bakeRecipeUpdateForm(uid, source, settings, name, 'schema') %>
						.show-hide-default-event This recipe triggers events with some default properties. 
							|<span class="toggle-default-event" data-status="<%= set_default_event %>"><%= formatDefaultEventEnabled(set_default_event) %></span>
						|<div class="default-event-container" <% (set_default_event) ? print(' style="display:block;"') : print('') %>>
						<%= bakeRecipeUpdateForm(uid, source, default_event, name, 'default_event') %>
						|</div>
						.buttons-container
							button.cancel Cancel
							input.save(type="submit", value="Save")
							input.destroy(type="button", value="Delete")

	script(type="text/jst")#recipe-creator-templ
		|<div class="drawer-list-outer scroll-to" data-destination="<%= source %>">
		.drawer-list-inner
			.title <%= prettyPrintSource(source) %>
		|</div>

	script(type="text/jst")#recipe-form-templ
		.recipe-form-container
			|<div class="title" id="<%= source %>-recipe"><span class="service-icon" data-service="<%= serviceFromSource(source) %>"></span><span class="text">New <%= prettyPrintSource(source) %> recipe</span></div>
			form
				<%= bakeForm(schema) %>
				.show-hide-default-event This recipe triggers events with some default properties. 
					span.toggle-default-event(data-status="false") Disabled
				.default-event-container
					<%= bakeForm(default_event) %>
				.buttons-container
					input.save(type="submit", value="Create")
					span.submit-msg

	script(type="text/jst")#river-item-templ
		.river-item-container.modal-parent
			.approval-child(data-which="btns")
				.approval-btn-container(data-which="yes")
					.approval-btn ✓
				.approval-btn-container(data-which="no")
					.approval-btn ×
			.approval-child(data-which="info")
				.toolbar
					.origin-recipe From recipe: <%= getRecipeFromId(recipe_id).name %>
				.title <%= name %>
				.description <%= text %>
			.modal-outer
				.modal-overlay
				.modal-inner
					.title Create new event
					.description Add options here and a form for adding a tag, associating with an article etc.
					form
						.buttons-container
							button.cancel Cancel
							input.save(type="submit", value="Create")

block bootstrap-data
	script(id="page-data").
		var pageData = {};
		pageData.org =!{JSON.stringify(org)};   
		pageData.recipeSchemas =!{JSON.stringify(recipeSchemas)};   
		pageData.accountRecipes =!{JSON.stringify(accountRecipes)};   
		pageData.riverItems =!{JSON.stringify(riverItems)};   


block scripts
	script(src="javascripts/thirdparty/jquery-1.11.0.min.js")
	script(src="javascripts/thirdparty/underscore-min.js")
	script(src="javascripts/thirdparty/backbone-min.js")
	script(src="javascripts/thirdparty/d3.v3.min.js")
	script(src="javascripts/thirdparty/isotope.pkgd.min.js")
	//- script(src="javascripts/thirdparty/waypoints.min.js")
	script(src="javascripts/thirdparty/jquery-ui.min.js")

	//- Put it all together
	script(src="javascripts/main.bundled.js")